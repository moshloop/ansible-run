#!/bin/bash
ARGS=""
for ARG in $(compgen -e); do
    if [[ "$ARG}" == "AWS_"* ]]; then
        ARGS+=" -e $ARG=${!ARG}"
    fi
done

ARGS+="--volume ssh:/ssh --env SSH_AUTH_SOCK=/ssh/auth/sock"
if [[ -e ~/.ansible ]]; then
    ARGS+=" -v ~/.ansible:/root/.ansible"
fi

if [[ -e ~/.aws ]]; then
    ARGS+=" -v ~/.aws:/root/.aws"
fi

if [[ -e /work ]]; then
    ARGS+=" -v /work:/work "
fi
docker run --rm -it  $ARGS -v $PWD:$PWD -w $PWD moshloop/ansible-runner bash -c "$@"